<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ゼロからできる！医師が教えるChatGPTでExcelを5倍活用する方法</title>
<style>
    body {
        font-family: Arial, sans-serif;
    }
    nav {
        background-color: #f8f8f8;
        padding: 10px;
    }
    nav div {
        margin-bottom: 10px;
    }
    nav a {
        margin: 0 10px;
        text-decoration: none;
        color: #007BFF;
    }
    section {
        margin-bottom: 50px;
    }
    h2 {
        color: #333;
        margin-bottom: 0; /* タイトルの下の余白をなくす */
    }
    pre {
        background-color: #f4f4f4;
        padding: 10px;
        border: 1px solid #ddd;
        overflow-x: auto;
    }
    blockquote {
        background-color: #f9f9f9;
        border-left: 10px solid #ccc;
        margin: 0.5em 10px;
        padding: 0.5em 10px;
    }
    .code-container {
        position: relative;
        margin-bottom: 1em;
    }
    /* 修正箇所 */
    .step-title-container {
        display: flex;
        align-items: center;
        justify-content: flex-start; /* スペースを均等に配置する */
        gap: 10px; /* タイトルとボタンの間にスペースを追加 */
        margin-bottom: 0em;
        position: relative;
    }

    .copy-button {
        margin-left: auto; /* タイトルの右端に配置する */
        z-index: 10;
    }
</style>

</head>
<body>
    <h1>ゼロからできる！<br>医師が教えるChatGPTでExcelを5倍活用する方法</h1>

    <nav>
        <div><strong>依頼文</strong></div>
        <div>
            <a href="#request-step1">ステップ1</a>
            <a href="#request-step2">ステップ2</a>
            <a href="#request-step3">ステップ3</a>
            <a href="#request-step4">ステップ4</a>
            <a href="#request-step5">ステップ5</a>
            <a href="#request-step6">ステップ6</a>
            <a href="#request-step7">ステップ7</a>
            <a href="#request-step8">ステップ8</a>
            <a href="#request-step9">ステップ9</a>
            <a href="#request-step10">ステップ10</a><br>
            <a href="#request-step11">ステップ11</a>
            <a href="#request-step12">ステップ12</a>
            <a href="#request-step13">ステップ13</a>
            <a href="#request-step14">ステップ14</a>
            <a href="#request-step15">ステップ15</a>
            <a href="#request-step16-1">ステップ16-1</a> 
            <a href="#request-step16-2">ステップ16-2</a> 
            <a href="#request-step17-1">ステップ17-1</a>
            <a href="#request-step17-2">ステップ17-2</a>
        </div>
        <div><strong>コード例</strong></div>
        <div>
            <a href="#code-step1">ステップ1</a>
            <a href="#code-step2">ステップ2</a>
            <a href="#code-step3">ステップ3</a>
            <a href="#code-step4">ステップ4</a>
            <a href="#code-step5">ステップ5</a>
            <a href="#code-step6">ステップ6</a>
            <a href="#code-step7">ステップ7</a>
            <a href="#code-step8">ステップ8</a>
            <a href="#code-step9">ステップ9</a>
            <a href="#code-step10">ステップ10</a><br>
            <a href="#code-step11">ステップ11</a>
            <a href="#code-step12">ステップ12</a>
            <a href="#code-step13">ステップ13</a>
            <a href="#code-step14">ステップ14</a>
            <a href="#code-step15">ステップ15</a>    
            <a href="#code-step16-1">ステップ16-1</a>    
            <a href="#code-step16-2">ステップ16-2</a> 
            <a href="#code-step17-1">ステップ17-1</a>
            <a href="#code-step17-2">ステップ17-2</a>
        </div>
    </nav>

        <h2>フィードバックをお寄せください</h2>
    <p><a href="feedback.html">こちらのフォーム</a>からフィードバックをお寄せください。</p>
    
    <!-- 依頼文セクション -->
    <section id="request-step1">
        <div class="step-title-container">
            <h2>ステップ1： 「A1セル」に「現在の年月」を書く</h2>
            <button class="copy-button" onclick="copyToClipboard('#requestText1')">コピーする</button>
        </div>
        <div class="code-container">
            <blockquote id="requestText1">
                Excelで「Sheet1」のセルA1に、<br>
                「現在の年月」を表示するマクロを<br>
                「DisplayCurrentYearMonth」という名前で作りたいです。<br>
                セル「A1からG1まで」を結合してください。<br>
                「現在の年月」を 「YYYY/MM」形式で、<br>
                「中央揃え」で表示されるようにしてください。<br><br>
                コードを教えてください。
            </blockquote>
        </div>
    </section>

    <section id="request-step2">
        <div class="step-title-container">
            <h2>ステップ2： 「曜日」を書く</h2>
            <button class="copy-button" onclick="copyToClipboard('#requestText2')">コピーする</button>
        </div>
        <div class="code-container">
            <blockquote id="requestText2">
                Excelで「Sheet1」の「セルA2からG2」に、<br>
                カレンダーの曜日ヘッダー（日、月、火、水、木、金、土）を表示するマクロを<br>
                「SetCalendarHeaders」という名前で作りたいです。<br>
                「中央揃え」で表示されるようにしてください。<br><br>
                コードを教えてください。
            </blockquote>
        </div>
    </section>

    <section id="request-step3">
        <div class="step-title-container">
            <h2>ステップ3： 「枠線」を書く</h2>
            <button class="copy-button" onclick="copyToClipboard('#requestText3')">コピーする</button>
        </div>
        <div class="code-container">
            <blockquote id="requestText3">
                Excelで「Sheet1」の「セルA2からG8」に、<br>
                カレンダーの枠線を引くマクロを<br>
                「DrawCalendarBorders」という名前で作りたいです。<br><br>
                コードを教えてください。
            </blockquote>
        </div>
    </section>

    <section id="request-step4">
        <div class="step-title-container">
            <h2>ステップ4： 「日付」を書く</h2>
            <button class="copy-button" onclick="copyToClipboard('#requestText4')">コピーする</button>
        </div>
        <div class="code-container">
            <blockquote id="requestText4">
                Excelで「Sheet1」にカレンダーがあり、<br>
                ・ セルA1に、カレンダーの年月（「YYYY/MM」形式）<br>
                ・ セルA2からG2に、曜日ヘッダー（日,月,火,水,木,金,土）<br>
                がすでに入力されています。<br><br>
                すでに入力されている部分はそのままで、<br>
                次の手順を実行するマクロを<br>
                「AddDates」という名前で作ってほしいです。<br><br>
                ・ 当月の1日の日付を取得し、開始日に設定<br>
                ・ 当月の1日から月末までの日付を順に入力するためのループ処理を作成<br>
                ・ 入力は、シートの3行目から始め、１日目は曜日に対応する列に入力<br>
                ・ 入力する日付は数字のみで中央揃え<br>
                ・ ループ処理内で、1週間が終わるごとに次の行に移動<br>
                ・ 最終日までの日付を入力<br>
                注意：<br>
                ・ DateSerial関数で日付を取得<br>
                ・ Weekday関数で、日付の曜日を取得（日曜日を1とする）<br>
                ・ ループ処理にはDo While ループを使用<br><br>
                コードを教えてください。
            </blockquote>
        </div>
    </section>

    <section id="request-step5">
        <div class="step-title-container">
            <h2>ステップ5： 「土曜日を青」、「日曜日を赤」にする</h2>
            <button class="copy-button" onclick="copyToClipboard('#requestText5')">コピーする</button>
        </div>
        <div class="code-container">
            <blockquote id="requestText5">
                Excelで「Sheet1」にカレンダーがあり、<br>
                「文字色」を変更するマクロを、<br>
                「ColorWeekends」という名前で作ってください。<br>
                    ・G2:G8を青フォント<br>
                    ・A2:A8を赤フォント<br><br>
                コードを教えてください。<br>        
            </blockquote>
        </div>
    </section>

    <section id="request-step6">
        <div class="step-title-container">
            <h2>ステップ6： 「祝日」シートに、「祝日リスト」を書く</h2>
            <button class="copy-button" onclick="copyToClipboard('#requestText6')">コピーする</button>
        </div>
        <div class="code-container">
            <blockquote id="requestText6">
                Excelで、<br>
                祝日リストを「祝日」というシートに書き込むマクロを<br>
                「CreateHolidaySheet」という名前で作成したいです。<br><br>
            
                ・「祝日」というシートに、下の祝日リストを書き込む。<br>
                ・すでに「祝日」というシートがある場合、<br>
                内容とフォーマットをws.Cells.Clearとws.Cells.ClearFormatsでクリア<br>
                ・シートの削除は禁止<br>
                ・A1に「祝日名」、B1に「日付」と入力し、「黄色塗りつぶし」<br>
                ・A2以下に祝日名、B2以下に「YYYY/MM/DD」の形式で祝日の日付を入力<br>
                ・継続記号「_」は多用せず、Arrayを1行に2つずつ<br>
                ・祝日リストは、下の「祝日リスト」を参照<br>
                ・祝日リストをコード内に直接書く<br><br>
            
                祝日リスト:<br>
                "元日", "2024/1/1", "成人の日", "2024/1/8",<br>
                "建国記念の日", "2024/2/11", "休日", "2024/2/12",<br>
                "天皇誕生日", "2024/2/23", "春分の日", "2024/3/20",<br>
                "昭和の日", "2024/4/29", "憲法記念日", "2024/5/3",<br>
                "みどりの日", "2024/5/4", "こどもの日", "2024/5/5",<br>
                "休日", "2024/5/6", "海の日", "2024/7/15",<br>
                "山の日", "2024/8/11", "休日", "2024/8/12",<br>
                "敬老の日", "2024/9/16", "秋分の日", "2024/9/22",<br>
                "休日", "2024/9/23", "スポーツの日", "2024/10/14",<br>
                "文化の日", "2024/11/3", "休日", "2024/11/4",<br>
                "勤労感謝の日", "2024/11/23", "元日", "2025/1/1",<br>
                "成人の日", "2025/1/13", "建国記念の日", "2025/2/11",<br>
                "天皇誕生日", "2025/2/23", "休日", "2025/2/24",<br>
                "春分の日", "2025/3/20", "昭和の日", "2025/4/29",<br>
                "憲法記念日", "2025/5/3", "みどりの日", "2025/5/4",<br>
                "こどもの日", "2025/5/5", "休日", "2025/5/6",<br>
                "海の日", "2025/7/21", "山の日", "2025/8/11",<br>
                "敬老の日", "2025/9/15", "秋分の日", "2025/9/23",<br>
                "スポーツの日", "2025/10/13", "文化の日", "2025/11/3",<br>
                "勤労感謝の日", "2025/11/23", "休日", "2025/11/24"<br><br>
            
                最後に、<br>
                A1からB列最下段の範囲で、<br>
                ・「枠線」<br>
                ・「中央ぞろえ」<br>
                ・セル幅を「AutoFit」<br><br>

                コードを教えてください。
            </blockquote>
        </div>
    </section>

    <section id="request-step7">
        <div class="step-title-container">
            <h2>ステップ7： 「祝日を赤」にする</h2>
            <button class="copy-button" onclick="copyToClipboard('#requestText7')">コピーする</button>
        </div>
        <div class="code-container">
            <blockquote id="requestText7">
                Excelの「Sheet1」にカレンダーがあります<br>
                    ・A1は年月（「YYYY/MM」形式）<br>
                    ・A2からG2に曜日ヘッダー（日、月、火、水、木、金、土）<br>
                    ・日付はA3からG8までの範囲に、「1」から「最終日」まで入力済<br>
                    ・日付は数値のみで表示されています（例：1, 2, 3など）<br>
                    ・「祝日」というシートがあり、祝日リストは以下の形式で入力されています<br>
                        1. 1行目はヘッダー<br>
                        2. A列に祝日の名前<br>
                        3. B列に「YYYY/MM/DD」形式で日付<br>
                以下の手順でカレンダーの日付を祝日リストの日付と比較し、<br>
                一致する場合は赤フォントにするマクロ「MarkHolidaysInRed」を作成してください。<br>
                
                具体的な手順<br>
                    1. シート「Sheet1」と「祝日」の参照を取得<br>
                    2. 「Sheet1」A1の値（「YYYY/MM」形式）から年と月を取得（例：「2023/05」→「2023」と「5」）<br>
                    3. カレンダーの日付範囲（A3からG8）をループし、各日付を、取得した年月と組み合わせてDateSerial関数で「YYYY/MM/DD」形式に変換<br>
                    4. 祝日リストの日付範囲（B2から最下段）をループし、各日付を比較<br>
                    5. 一致する日付が見つかった場合、そのカレンダーの日付を赤フォントに変更<br>
                注意点：<br>
                    1. カレンダーの日付を変換する際、Year関数とMonth関数を使用してセルA1の値から年と月を取得<br>
                    2. For Eachループを使用する際、変数をセルオブジェクトに適したものに設定<br>
                    （例：calendarCell、holidayCellはそれぞれRangeオブジェクト内の個々のセルを指します）<br>
                    3. 日付の比較にはDateSerial関数とDateValue関数を使用<br><br>
                コードを教えてください。
            </blockquote>
        </div>
    </section>

    <section id="request-step8">
        <div class="step-title-container">
            <h2>ステップ8： 「シートクリア」＆「カレンダー作成」</h2>
            <button class="copy-button" onclick="copyToClipboard('#requestText8')">コピーする</button>
        </div>
        <div class="code-container">
            <blockquote id="requestText8">
                Excelで「Sheet1」にカレンダーを作成しています。<br>
                シートを初期状態に戻してから<br>
                カレンダーを作成するためのマクロを<br>
                「InitializeAndCreateCalendar」という名前でほしいです。<br><br>
                
                具体的な要件は以下の通りです：<br>
                &nbsp;&nbsp;1. 「Sheet1」の内容、書式、結合をクリアする。<br>
                &nbsp;&nbsp;2. カレンダーを作成するための各コードを順に呼び出す。<br>
                
                &nbsp;&nbsp;- DisplayCurrentYearMonth<br>
                &nbsp;&nbsp;- SetCalendarHeaders<br>
                &nbsp;&nbsp;- DrawCalendarBorders<br>
                &nbsp;&nbsp;- AddDates<br>
                &nbsp;&nbsp;- ColorWeekends<br>
                &nbsp;&nbsp;- CreateHolidaySheet<br>
                &nbsp;&nbsp;- MarkHolidaysInRed<br>
                （各コードは既に実装されています）<br>
                （InitializeAndCreateCalendar以外のコードは作成しないでください）<br><br>
                コードを教えてください。
            </blockquote>
        </div>
    </section>

    <section id="request-step9">
        <div class="step-title-container">
            <h2>ステップ9： 「ダブルクリック」で「赤塗りつぶし」</h2>
            <button class="copy-button" onclick="copyToClipboard('#requestText9')">コピーする</button>
        </div>
        <div class="code-container">
            <blockquote id="requestText9">
                Excelの「Sheet1」で、<br>
                A3からG8のセルがダブルクリックされた時に、<br>
                以下の条件で動作するVBAコードをお願いします<br><br>
                &nbsp;&nbsp;1. セルが空でない場合、背景色を赤に設定<br>
                &nbsp;&nbsp;2. セルが赤の背景色の場合、再度ダブルクリックで背景色をクリア（塗りつぶしなし）<br>
                &nbsp;&nbsp;3. ダブルクリックによるセルの編集を防ぐ<br><br>
                コードを教えてください。
            </blockquote>
        </div>
    </section>

    <section id="request-step10">
        <div class="step-title-container">
            <h2>ステップ10： 仮の「メンバーシート」作成</h2>
            <button class="copy-button" onclick="copyToClipboard('#requestText10')">コピーする</button>
        </div>
        <div class="code-container">
            <blockquote id="requestText10">
                Excelで「管理用」というシートに、<br>
                下のようなメンバーリストを作成する「CreateMemberList」という<br>
                コードがほしいです。<br>
                
                「管理用」シートが既に存在する場合、<br>
                そのシートを削除せずに、<br>
                内容と書式をクリアしてから新しいデータを入力します。<br>
                （`ws.Cells.Clear`と`ws.Cells.ClearFormats`を使用）<br>
                「管理用」シートを準備したのち、<br>
                以下の順で動作するコードをお願いします。<br><br>

                <ol>
                    <li>A1に「No」、B1に「氏名」、C1に「休み希望」と入力</li>
                    <li>A1:C1を「黄色塗りつぶし」、「太字」</li>
                    <li>A列に通し番号</li>
                    <li>B列に20人分のメンバー名を入力<br>
                    （氏名はリスト通り、フルネームにしてください）</li>                
                20人分のメンバーリスト：
                <ul>
                    <li>田中 太郎</li>
                    <li>山田 花子</li>
                    <li>佐藤 雄大</li>
                    <li>鈴木 美咲</li>
                    <li>高橋 健太</li>
                    <li>伊藤 まどか</li>
                    <li>渡辺 拓也</li>
                    <li>斎藤 亜美</li>
                    <li>小林 健介</li>
                    <li>中村 みゆき</li>
                    <li>加藤 大輔</li>
                    <li>吉田 美和</li>
                    <li>山口 剛</li>
                    <li>林 さくら</li>
                    <li>清水 明美</li>
                    <li>阿部 健太郎</li>
                    <li>森田 未来</li>
                    <li>岡田 優子</li>
                    <li>橋本 貴之</li>
                    <li>山崎 瞳</li>
                </ul>
                     <li>A1:C21を、「中央揃え]、「格子枠」、AutoFitで幅調整</li>
                </ol>
                コードを教えてください。
            </blockquote>
        </div>
    </section>

    <section id="request-step11">
        <div class="step-title-container">
            <h2>ステップ11： 「各メンバー用のカレンダー」作成</h2>
            <button class="copy-button" onclick="copyToClipboard('#requestText11')">コピーする</button>
        </div>
        <div class="code-container">
            <blockquote id="requestText11">
                Excelで「管理用」シートのB列、<br>
                B2以下最下段までのセルを、<br>
                ダブルクリックしたときに実行される、<br>
                「管理用」シートのコードが欲しいです。<br><br>
                &nbsp;&nbsp;1. ダブルクリックされたセル内容を取得<br>
                &nbsp;&nbsp;2. InitializeAndCreateCalendar マクロを呼び出す。<br>
                &nbsp;&nbsp;3. 「Sheet1」をアクティブにする<br>
                &nbsp;&nbsp;4. 「Sheet1」のA1セルに「半角スペース」と「取得したセル内容」を追記<br>
                &nbsp;&nbsp;&nbsp;&nbsp;引数は渡さないで実装してください。<br><br>
                コードを教えてください。
            </blockquote>
        </div>
    </section>

    <section id="request-step12">
        <div class="step-title-container">
            <h2>ステップ12： 「休み希望」の「確定ボタン」設置</h2>
            <button class="copy-button" onclick="copyToClipboard('#requestText12')">コピーする</button>
        </div>
        <div class="code-container">
            <blockquote id="requestText12">
                Excelの「Sheet1」に、<br>
                コマンドボタンを追加する、<br>
                「AddCommandButton」というコードが欲しいです。<br>
                &nbsp;&nbsp;&nbsp;&nbsp;1. ボタンはActiveX（OLEObjects）<br>
                &nbsp;&nbsp;&nbsp;&nbsp;2. ボタンのキャプションは「確定」<br>
                &nbsp;&nbsp;&nbsp;&nbsp;3. Objectプロパティを使用し、名前を「btnKakutei」にする<br>
                &nbsp;&nbsp;&nbsp;&nbsp;4. 位置は「セルI3とI4」、サイズは「セルI3とI4」の2マス分<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ボタンの位置とサイズを取得するために、<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;セルI3の上端位置と左端位置、セルI4の左端位置と上端位置を使用<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;セルI4の幅と高さも考慮<br>
                &nbsp;&nbsp;&nbsp;&nbsp;5. 既に同じ名前のボタンが存在する場合は、そのボタンを削除してから新しいボタンを追加<br><br>
                注意: 必要な機能以外のオプションやコードは追加しないでください。<br><br>
                コードを教えてください。
            </blockquote>
        </div>
    </section>

    <section id="request-step13">
        <div class="step-title-container">
            <h2>ステップ13： 「確定ボタン」で「休み希望」を収集</h2>
            <button class="copy-button" onclick="copyToClipboard('#requestText13')">コピーする</button>
        </div>
        <div class="code-container">
            <blockquote id="requestText13">
                Excelの「Sheet1」にある<br>
                「btnKakutei」というコマンドボタンのクリック時に、<br>
                以下の処理を実行するコードを書いてください：<br>
                &nbsp;&nbsp;&nbsp;&nbsp;1.「Sheet1」を設定<br>
                &nbsp;&nbsp;&nbsp;&nbsp;2.  A1セルの値を取得<br>
                &nbsp;&nbsp;&nbsp;&nbsp;3. 最初の半角スペース以降の文字列を「メンバー名」として取得<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;半角スペースが見つからなければ、終了<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;メンバー名のスペースは除去しない<br>
                &nbsp;&nbsp;&nbsp;&nbsp;4. 「Sheet1」のA3からG8までの範囲をループし、<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;赤く塗りつぶされたセルの数値（値）を取得し、カンマ区切りの文字列にしてください<br>
                &nbsp;&nbsp;&nbsp;&nbsp;5. 「管理用」シートのB列で「メンバー名」を検索し、<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;見つかった行のC列に赤塗りつぶしセルの数値をカンマ区切りで入力<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;（区切りはカンマのみで、スペースは不要、既存の値がある場合は、上書き）<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;「メンバー名」が見つからなければ終了<br><br>
                コードを教えてもらえますか。
            </blockquote>
        </div>
    </section>

    <section id="request-step14">
        <div class="step-title-container">
            <h2>ステップ14： 「選択セル」に「メンバー」を自動割付</h2>
            <button class="copy-button" onclick="copyToClipboard('#requestText14')">コピーする</button>
        </div>
        <div class="code-container">
            <blockquote id="requestText14">
                Excelの「Sheet1」の「選択セル」にメンバーを割り当てるための<br>
                「AssignShifts」というVBAコードを作成してください。<br>
                カレンダーの構成は以下の通りです。<br>
                &nbsp;&nbsp;・セルA1は現在の年月（「YYYY/MM」形式）<br>
                &nbsp;&nbsp;・セルA2からG2に曜日ヘッダー（日、月、火、水、木、金、土）<br>
                &nbsp;&nbsp;・セルA2からG8に枠線<br>
                &nbsp;&nbsp;・日付はA3からG8までの位置で、「1」から「最終日」まで入力済<br>
                &nbsp;&nbsp;・日付は数値のみで表示されています（例：1, 2, 3など）<br><br>
            
                「管理用」というシートにメンバーリストがあります。<br>
                    各変数はカッコ内の設定でお願いします。<br><br>
                1. 「Sheet1」の「選択セル」が以下なら終了<br>
                &nbsp;&nbsp;・ 複数のセルが選択されている<br>
                &nbsp;&nbsp;・ A3:G8以外のセルが選択されている<br>
                &nbsp;&nbsp;・ 選択セルの内容が「空欄」<br>
                &nbsp;&nbsp;・ 選択セルの内容が「数値」でない<br><br>
                
                2. 「管理用」シート処理<br>
                &nbsp;&nbsp;・ B列B2以下からMemberList(Range)を取得<br>
                &nbsp;&nbsp;・ C列C2以下(カンマ区切りで入っている「数値」)からMemberOffs（Object, Scripting.Dictionaryを使用）を取得<br>
                &nbsp;&nbsp;・ メンバー毎のMemberOffsの「個数」をOffCount(Object, Scripting.Dictionaryを使用）として取得<br><br>
                
                3. 「Sheet1」処理<br>
                &nbsp;&nbsp;・ 「選択セル」の「数値」をshiftDate(String)として取得<br>
                &nbsp;&nbsp;・ 隣接セル（セル位置で場合分けあり）のメンバーをadjacentMembers(Collection)として取得：<br>
                &nbsp;&nbsp;    選択セルがB3:F8の場合、<br>
                &nbsp;&nbsp;    左右の隣接セルがMemberListにあるメンバー名を含む(部分一致)なら、<br>
                &nbsp;&nbsp;    そのメンバーをadjacentMembers(Collection)として取得<br>
                &nbsp;&nbsp;    ただし、選択セルがA列の場合は、<br>
                &nbsp;&nbsp;    そのB列セルまたは一行上のG列セルがMemberListにあるメンバー名を含む(部分一致)なら、<br>
                &nbsp;&nbsp;    そのメンバーをadjacentMembersとして取得<br>
                &nbsp;&nbsp;    また、選択セルがG列の場合は、<br>
                &nbsp;&nbsp;    そのF列セルまたは一行下のA列セルがMemberListにあるメンバー名を含む(部分一致)なら、<br>
                &nbsp;&nbsp;    そのメンバーをadjacentMembersとして取得<br>
                &nbsp;&nbsp;・ A3:G8で、MemberListにあるメンバー名を含む(部分一致)セルの個数を<br>
                &nbsp;&nbsp;    MemberCount(Object, Scripting.Dictionaryを使用)としてメンバー毎に取得<br><br>
                
                4. メンバーから「候補」の絞り込み<br>
                &nbsp;&nbsp;・ MemberListのうち、<br>
                    &nbsp;&nbsp;shiftDateを、MemberOffsに含まないメンバーをCandidates(Collection)として取得<br>
                &nbsp;&nbsp;・ Candidatesを配列candidateArray(Variant)にし、<br>
                    &nbsp;&nbsp;MemberCountが少ないメンバーをCandidatesに残す<br>
                &nbsp;&nbsp;・ 全員が同じMemberCountであれば、全員をCandidatesに残す<br>
                &nbsp;&nbsp;・ CandidatesからadjacentMembersを外す<br>
                &nbsp;&nbsp;・ Candidatesのうち、最多のOffCountをもつメンバーをCandidatesに残す<br><br>
                
                5. Candidatesをシャッフルし、メンバー1人を選択し、<br>
                &nbsp;&nbsp;    選択セル内容に「改行区切り」で追記する<br><br>
                
                以下の関数を実装してください：<br>
                &nbsp;&nbsp;・ IsNumberInArray：指定した数値が配列内に存在するかどうかを判定<br>
                &nbsp;&nbsp;・ IsInCollection：指定したキーがコレクション内に存在するかどうかを判定<br>
                &nbsp;&nbsp;・ GetOffCounts：指定した候補配列から休み希望日数を取得<br>
            </blockquote>
        </div>
    </section>

    <section id="request-step15">
        <div class="step-title-container">
            <h2>ステップ15： 「一か月分」の「メンバー」を自動割付</h2>
            <button class="copy-button" onclick="copyToClipboard('#requestText15')">コピーする</button>
        </div>
        <div class="code-container">
            <blockquote id="requestText15">
                Excelで「Sheet1」上のカレンダーにメンバーを割り当てるための<br>
                「AssignShiftsBasedOnMemberOffDays」という<br>
                VBAコードを作成してください。<br>
                カレンダーの構成は以下の通りです。<br>
                &nbsp;&nbsp;・A3:G8に「1」から「最終日」まで入力済<br>
                &nbsp;&nbsp;・日付は数値のみで表示されています（例：1, 2, 3など）<br>

                「管理用」というシートにメンバーリストがあり、<br>
                コードを実行すると、<br>
                以下のルールに従って、<br>
                Sheet1のA3:G8の範囲で選択セルを移動しながら「AssignShifts」という<br>
                メンバー割付関数を引数なしで呼び出します。<br>
                （AssignShiftsは実装済みです）<br>
                <ol>
                    <li>メンバーの取得：
                        <ul>
                            <li>「管理用」シートで処理<br>
                            <li>B列に「メンバー名」<br>
                            <li>C列に「休み希望」の「数値」がカンマ区切りで並ぶ<br>
                            <li>MemberList配列でメンバー名を格納</li>
                            <li>各メンバーと「休み希望」の数値をMemberOffs（Scripting.Dictionary オブジェクト）に格納</li>
                        </ul>
                    </li>
                    <li>休み希望日数のカウントとソート：
                        <ul>
                            <li>各メンバーの「休み希望」数をForループで`OffCountArray`で配列に格納</li>
                            <li>メンバーを「休み希望」数で、`BubbleSort`関数を使って降順にソート</li>
                            <li>`BubbleSort` 関数は2次元配列を指定された列で降順にソートします</li>
                        </ul>
                    </li>
                    <li>カレンダーの日数の範囲決定：
                        <ul>
                            <li>カレンダーは Sheet1 のA3:G8の範囲</li>
                            <li>セル内容の「最大値（maxDay）」を`GetMaxDayInCalendar` 関数で取得(月の最終日に相当)</li>
                            <li>この関数は、指定されたカレンダー範囲内の「最大数」を返す</li>
                        </ul>
                    </li>
                    <li>シフトの割り付け：
                        <ul>
                            <li>ソートされたメンバーごとに、1からmaxDayの数値から、「休み希望」(MemberOffs)を除外したcollectionを取得</li>
                            <li>ランダムに1つの数値を選択</li>
                            <li>選択した数値がSheet1のA3:G8のセル内容と一致する場合、そのセルを選択</li>
                            <li>その状態で「AssignShifts」を引数なしで呼び出す</li>
                            <li>全メンバーについて同様の処理を行い、最初のメンバーに戻り、同じ処理を繰り返す</li>
                            <li>全てのセルに割り付けが完了するまでループを継続</li>
                            <li>A3:G8全てのセル内容が数値のみでないことを`AllCellsAssigned` 関数で確認</li>
                        </ul>
                    </li>
                </ol>
                補助関数の実装：
                <ul>
                    <li>BubbleSort: 2次元配列を指定された列で降順にメンバーをソート</li>
                    <li>GetMaxDayInCalendar: カレンダーA3:G8範囲内の最大数値を取得(数値以外のセルは無視)</li>
                    <li>FindDateCell: 指定した数値と一致するセルを探す。見つからない場合は `Nothing` を返す</li>
                    <li>IsNumberInArray: 指定した数が配列に含まれているかを確認（引数はstring型）</li>
                    <li>AllCellsAssigned: A3:G8範囲内の全てのセル内容が数値のみではないことを確認</li>
                </ul>
                変数の型指定：
                <ul>
                    <li>wsManagementとwsはWorksheet型。</li>
                    <li>memberCellはRange型。</li>
                    <li>memberOffDaysはVariant型。</li>
                    <li>offCountArrayとsortedMembersはVariant配列。</li>
                    <li>availableDaysはCollection型。</li>
                    <li>dayはVariant (FindDateCellに渡す前にCLng(day)でLongに変換)</li>
                    <li>maxDayはLong型</li>
                    <li>memberはString型</li>
                    <li>iとjはLong型</li>
                    <li>allAssignedはBoolean型</li>
                </ul>
                注意点：
                <ul>
                    <li>For Eachループで使用する変数は、必ずVariant型またはObject型として宣言してください。</li>
                </ul>
                この指定に基づいて、適切なVBAコードを提供してください。
            </blockquote>
        </div>
    </section>

    <section id="request-step16-1">
        <div class="step-title-container">
            <h2>ステップ16-1： 「保存終了」ボタンを設置</h2>
            <button class="copy-button" onclick="copyToClipboard('#requestText16-1')">コピーする</button>
        </div>
        <div class="code-container">
            <blockquote id="requestText16-1">
                Excelの「Sheet1」に、<br>
                コマンドボタンを追加する、<br>
                「AddCommandButton2」というVBAコードが欲しいです。<br>
                &nbsp;&nbsp;1. ボタンはActiveX（OLEObjects）<br>
                &nbsp;&nbsp;2. ボタンのキャプションは「保存終了」<br>
                &nbsp;&nbsp;3. Objectプロパティを使用し、名前を「btnHozonShuryo」にする<br>
                &nbsp;&nbsp;4. 位置は「セルI5とI6」、サイズは「セルI5とI6」の2マス分<br>
                &nbsp;&nbsp;&nbsp;&nbsp;ボタンの位置とサイズを取得するために、<br>
                &nbsp;&nbsp;&nbsp;&nbsp;セルI5の上端位置と左端位置、セルI6の左端位置と上端位置を使用<br>
                &nbsp;&nbsp;&nbsp;&nbsp;セルI6の幅と高さも考慮<br>
                &nbsp;&nbsp;5. 既に同じ名前のボタンが存在する場合は、そのボタンを削除してから新しいボタンを追加<br><br>
                コードを教えてください。
            </blockquote>
        </div>
    </section>

    <section id="request-step16-2">
        <div class="step-title-container">
            <h2>ステップ16-2： 「保存終了」ボタンでバックアップファイル作成</h2>
            <button class="copy-button" onclick="copyToClipboard('#requestText16-2')">コピーする</button>
        </div>
        <div class="code-container">
            <blockquote id="requestText16-2">
                Excelの「Sheet1」にある「btnHozonShuryo」というコマンドボタンのコードが欲しいです。<br>
                コードは以下の要件を満たしてください。<br>
                &nbsp;&nbsp;    ・ ボタンクリックで以下の内容が実行される<br>
                &nbsp;&nbsp;    ・ 現在のワークブックのバックアップファイルを作成する<br>
                &nbsp;&nbsp;    ・ 現在のワークブックのパスと名前を取得<br>
                &nbsp;&nbsp;    ・ 日時をもとにバックアップファイルのパスを設定（例：backup_yyyymmdd_hhmmss.xlsm）<br>
                &nbsp;&nbsp;    ・ 「ThisWorkbook.SaveAs」を用いてバックアップファイルとして保存<br>
                &nbsp;&nbsp;    ・ 元の名前で再度保存し、ワークブックを閉じる<br>
                &nbsp;&nbsp;    ・ エラーが発生しないように、アラートメッセージを無効化し、後で再有効化する<br><br>
                コードを教えてください。
            </blockquote>
        </div>
    </section>

       <section id="request-step17-1">
        <div class="step-title-container">
            <h2>ステップ17-1：  1か月分のExcelファイルを含むフォルダを作成</h2>
            <button class="copy-button" onclick="copyToClipboard('#requestText17-1')">コピーする</button>
        </div>
        <div class="code-container">
            <blockquote id="requestText17-1">
                Excelファイルが入った、<br>
                「2024.4」というフォルダを作成する<br>
                「CreateExcelFiles」というコードが欲しいです。<br>
                最初にフォルダを保存する場所を<br>
                「フォルダ選択ダイアログ」で選択し、<br>
                そこに 「2024.4」というフォルダを作成します。<br>
                そのフォルダ内に、以下のExcelファイルを保存します。<br><br>
                それぞれのExcelファイルは以下のようにフォーマットしてください。<br>
                &nbsp;&nbsp;1. A1:F1、それぞれ　病名、A病、B病、C病、D病、E病と入力<br>
                &nbsp;&nbsp;2. A1:F1、黄色塗りつぶし（Interior.Color で設定）<br>
                &nbsp;&nbsp;3. A2、「患者数」と入力<br>
                &nbsp;&nbsp;4. B2:F2、ランダムに数値を入力（例：79、94、97、33、31）<br>
                &nbsp;&nbsp;5. A1:F2、Bordersで格子枠<br>
                &nbsp;&nbsp;6. A1:F2、文字をHorizontalAlignment と VerticalAlignmentで中央揃え<br>
                &nbsp;&nbsp;7. A1:F2、列幅をColumns.AutoFitで調整<br><br>
                各Excelファイルには、<br>
                ランダムな患者数データを生成してください。<br>
                ファイル名は `4.1.xlsx` から `4.30.xlsx` とし、<br>
                最後にそのフォルダに、「データ集積用」という名前の、<br>
                カラのExcelファイルも追加してください。<br><br>
                コードを教えてください。
            </blockquote>
        </div>
    </section>

        <section id="request-step17-2">
        <div class="step-title-container">
            <h2>ステップ17-2： 1か月分のExcelファイルからのデータ収集</h2>
            <button class="copy-button" onclick="copyToClipboard('#requestText17-2')">コピーする</button>
        </div>
        <div class="code-container">
            <blockquote id="requestText17-2">
                現在のワークブックが置かれているフォルダ内のExcelファイルからデータを収集し、<br>
                アクティブシートに取り込んで表示する、<br>
                「ImportData」というコードが欲しいです<br>
                フォルダ内の各ファイル名にある日付ごとにデータを読み込み、<br>
                シートに貼り付け、<br>
                合計と平均を計算して表示します。<br>
                以下の順序で処理を進めるようにしてください。<br><br>
            
                1. フォルダパスとフォルダ名の設定:<br>
                &nbsp;&nbsp;現在のワークブックが置かれているフォルダのパスを取得<br>
                &nbsp;&nbsp;フォルダ名の抽出は、<br>
                &nbsp;&nbsp;フォルダパスから末尾のバックスラッシュを除去し、<br>
                &nbsp;&nbsp;最後のバックスラッシュ以降の部分をフォルダ名として抽出<br><br>
            
                2. フォルダ名の形式確認と年月の取得:<br>
                &nbsp;&nbsp;フォルダ名が "YYYY.M" または "YYYY.MM" 形式であることを確認<br>
                &nbsp;&nbsp;フォルダ名から年と月を取得します。<br>
                &nbsp;&nbsp;フォルダ名をドットで分割し、年と月を「数値」として取得<br>
                &nbsp;&nbsp;取得した月の最終日を計算<br>
                &nbsp;&nbsp;DateSerial 関数を使用して、<br>
                &nbsp;&nbsp;次の月の0日目（つまり、前月の最終日）を取得<br><br>
            
                3. アクティブシート内容をクリア:<br>
                &nbsp;&nbsp;アクティブシート全セル内容をクリア（Cells.Clear メソッドを使用）<br><br>
            
                4. ヘッダー設定とフォーマット:<br>
                &nbsp;&nbsp;A1に、フォルダ名から取得したmonthと合わせて「〇月」と表示<br>
                &nbsp;&nbsp;B1:F1に、「A病」、「B病」、「C病」、「D病」、「E病」と表示<br>
                &nbsp;&nbsp;A1:F1を、黄色塗りつぶし（Interior.Color で設定）<br><br>
            
                5. データのインポートと転記:<br>
                &nbsp;&nbsp;1日から月の最終日までのループ<br>
                &nbsp;&nbsp;具体的には、1から最終日までのループを設定します。<br>
                &nbsp;&nbsp;各日付（Dayのみ、例えば「1」）をA列に書き込む<br>
                &nbsp;&nbsp;各日付ごとにファイル名を作成（"M.D.xlsx" とし、例えば「4.1.xlsx」）<br>
                &nbsp;&nbsp;該当ファイルが現在のワークブックが置かれているフォルダ内に存在するかDir 関数を使って確認<br>
                &nbsp;&nbsp;ファイルが存在する場合、そのファイルをWorkbooks.Open メソッドで開く<br>
                &nbsp;&nbsp;開いたファイルのSheet1から、以下のセルのデータを取得します:<br>
                &nbsp;&nbsp;&nbsp;&nbsp;B2 のデータをアクティブシートのB列に転記<br>
                &nbsp;&nbsp;&nbsp;&nbsp;C2 のデータをアクティブシートのC列に転記<br>
                &nbsp;&nbsp;&nbsp;&nbsp;D2 のデータをアクティブシートのD列に転記<br>
                &nbsp;&nbsp;&nbsp;&nbsp;E2 のデータをアクティブシートのE列に転記<br>
                &nbsp;&nbsp;&nbsp;&nbsp;F2 のデータをアクティブシートのF列に転記<br>
                &nbsp;&nbsp;データ転記後、ファイルを閉じる<br><br>
            
                6. 合計と平均の計算:<br>
                &nbsp;&nbsp;BからF行まで、各列の「合計」をSUM 関数を使用して最下段に追加（A列に「合計」と表示）<br>
                &nbsp;&nbsp;その下の行に各列の「平均」をAVERAGE 関数と ROUND 関数を使用し、<br>
                &nbsp;&nbsp;小数点一桁までで追加（A列に「平均」と表示）<br><br>
            
                7. 全体のフォーマット設定:<br>
                &nbsp;&nbsp;データ範囲にBordersで格子枠、文字をHorizontalAlignment と VerticalAlignmentで中央揃え<br>
                &nbsp;&nbsp;最後に列の幅をColumns.AutoFitで調整<br><br>
            
                これが実行されるコードもらえますか。
            </blockquote>
        </div>
    </section>
    
    <!-- コード例セクション -->
    <section id="code-step1">
        <div class="step-title-container">
            <h2>ステップ1： 「A1セル」に「現在の年月」を書く</h2>
            <button class="copy-button" onclick="copyToClipboard('#codeExample1')">コピーする</button>
        </div>
        <div class="code-container">
            <pre id="codeExample1">
Sub DisplayCurrentYearMonth()
    Dim ws As Worksheet
    Dim currentYear As Integer
    Dim currentMonth As Integer

    ' Sheet1を取得
    Set ws = ThisWorkbook.Sheets("Sheet1")

    ' 現在の年と月を取得
    currentYear = Year(Date)
    currentMonth = Month(Date)

    ' セルA1からG1を結合して現在の年月を表示（YYYY/MM形式）
    With ws.Range("A1:G1")
        .Merge
        .Value = currentYear & "/" & Format(currentMonth, "00")
        .HorizontalAlignment = xlCenter
    End With
End Sub
            </pre>
        </div>
    </section>

    <section id="code-step2">
        <div class="step-title-container">
            <h2>ステップ2： 「曜日」を書く</h2>
            <button class="copy-button" onclick="copyToClipboard('#codeExample2')">コピーする</button>
        </div>
        <div class="code-container">
            <pre id="codeExample2">
Sub SetCalendarHeaders()
    Dim ws As Worksheet
    ' Sheet1を取得
    Set ws = ThisWorkbook.Sheets("Sheet1")
    ' 曜日ヘッダーをセルA2からG2に設定
    ws.Range("A2").Value = "日"
    ws.Range("B2").Value = "月"
    ws.Range("C2").Value = "火"
    ws.Range("D2").Value = "水"
    ws.Range("E2").Value = "木"
    ws.Range("F2").Value = "金"
    ws.Range("G2").Value = "土"
    ' 文字を中央揃えに設定
    ws.Range("A2:G2").HorizontalAlignment = xlCenter
End Sub
            </pre>
        </div>
    </section>

    <section id="code-step3">
        <div class="step-title-container">
            <h2>ステップ3： 「枠線」を書く</h2>
            <button class="copy-button" onclick="copyToClipboard('#codeExample3')">コピーする</button>
        </div>
        <div class="code-container">
            <pre id="codeExample3">
Sub DrawCalendarBorders()
    Dim ws As Worksheet
    Dim calendarRange As Range
    
    ' Sheet1を取得
    Set ws = ThisWorkbook.Sheets("Sheet1")
    
    ' カレンダー範囲を設定
    Set calendarRange = ws.Range("A2:G8")
    
    ' 外枠と内側の枠線を一括で設定
    With calendarRange.Borders
        .LineStyle = xlContinuous
        .Weight = xlThin
        .ColorIndex = 0
    End With
End Sub
            </pre>
        </div>
    </section>

    <section id="code-step4">
        <div class="step-title-container">
            <h2>ステップ4： 「日付」を書く</h2>
            <button class="copy-button" onclick="copyToClipboard('#codeExample4')">コピーする</button>
        </div>
        <div class="code-container">
            <pre id="codeExample4">
Sub AddDates()
    Dim ws As Worksheet
    Dim startDate As Date
    Dim currentDate As Date
    Dim currentRow As Integer
    Dim currentColumn As Integer
    Dim yearMonth As String
    Dim lastDay As Integer
    
    ' Sheet1を設定
    Set ws = ThisWorkbook.Sheets("Sheet1")
    
    ' セルA1から年月を取得
    yearMonth = ws.Range("A1").Value
    startDate = DateSerial(Left(yearMonth, 4), Mid(yearMonth, 6, 2), 1)
    
    ' 開始日を設定
    currentDate = startDate
    lastDay = day(DateSerial(year(startDate), month(startDate) + 1, 0))
    
    ' 開始行を設定
    currentRow = 3
    
    ' 1日の曜日に対応する列を取得
    currentColumn = Weekday(startDate, vbSunday)
    
    Do While currentDate <= DateSerial(year(startDate), month(startDate), lastDay)
        ' 現在の日付を対応する列に入力
        ws.Cells(currentRow, currentColumn).Value = day(currentDate)
        ws.Cells(currentRow, currentColumn).HorizontalAlignment = xlCenter
        
        ' 次の日付に進む
        currentDate = currentDate + 1
        currentColumn = currentColumn + 1
        
        ' 1週間が終わったら次の行に移動
        If currentColumn > 7 Then
            currentColumn = 1
            currentRow = currentRow + 1
        End If
    Loop
End Sub
            </pre>
        </div>
    </section>

    <section id="code-step5">
        <div class="step-title-container">
            <h2>ステップ5： 「土曜日を青」、「日曜日を赤」にする</h2>
            <button class="copy-button" onclick="copyToClipboard('#codeExample5')">コピーする</button>
        </div>
        <div class="code-container">
            <pre id="codeExample5">
Sub ColorWeekends()
    Dim ws As Worksheet
    Set ws = ThisWorkbook.Sheets("Sheet1")
    
    ' G2:G8を青フォント
    ws.Range("G2:G8").Font.Color = RGB(0, 0, 255)
    
    ' A2:A8を赤フォント
    ws.Range("A2:A8").Font.Color = RGB(255, 0, 0)
End Sub
            </pre>
        </div>
    </section>

    <section id="code-step6">
        <div class="step-title-container">
            <h2>ステップ6： 「祝日」シートに、「祝日リスト」を書く</h2>
            <button class="copy-button" onclick="copyToClipboard('#codeExample6')">コピーする</button>
        </div>
        <div class="code-container">
            <pre id="codeExample6">
Sub CreateHolidaySheet()
    Dim ws As Worksheet
    Dim holidayList As Variant
    Dim i As Long
    
    ' 祝日リストのデータ
    holidayList = Array( _
        Array("祝日名", "日付"), _
        Array("元日", "2024/1/1"), Array("成人の日", "2024/1/8"), _
        Array("建国記念の日", "2024/2/11"), Array("休日", "2024/2/12"), _
        Array("天皇誕生日", "2024/2/23"), Array("春分の日", "2024/3/20"), _
        Array("昭和の日", "2024/4/29"), Array("憲法記念日", "2024/5/3"), _
        Array("みどりの日", "2024/5/4"), Array("こどもの日", "2024/5/5"), _
        Array("休日", "2024/5/6"), Array("海の日", "2024/7/15"), _
        Array("山の日", "2024/8/11"), Array("休日", "2024/8/12"), _
        Array("敬老の日", "2024/9/16"), Array("秋分の日", "2024/9/22"), _
        Array("休日", "2024/9/23"), Array("スポーツの日", "2024/10/14"), _
        Array("文化の日", "2024/11/3"), Array("休日", "2024/11/4"), _
        Array("勤労感謝の日", "2024/11/23"), Array("元日", "2025/1/1"), _
        Array("成人の日", "2025/1/13"), Array("建国記念の日", "2025/2/11"), _
        Array("天皇誕生日", "2025/2/23"), Array("休日", "2025/2/24"), _
        Array("春分の日", "2025/3/20"), Array("昭和の日", "2025/4/29"), _
        Array("憲法記念日", "2025/5/3"), Array("みどりの日", "2025/5/4"), _
        Array("こどもの日", "2025/5/5"), Array("休日", "2025/5/6"), _
        Array("海の日", "2025/7/21"), Array("山の日", "2025/8/11"), _
        Array("敬老の日", "2025/9/15"), Array("秋分の日", "2025/9/23"), _
        Array("スポーツの日", "2025/10/13"), Array("文化の日", "2025/11/3"), _
        Array("勤労感謝の日", "2025/11/23"), Array("休日", "2025/11/24"))

    ' 祝日シートの存在確認
    On Error Resume Next
    Set ws = ThisWorkbook.Worksheets("祝日")
    On Error GoTo 0
    
    ' シートが存在しない場合は作成
    If ws Is Nothing Then
        Set ws = ThisWorkbook.Worksheets.Add
        ws.Name = "祝日"
    Else
        ' シートの内容とフォーマットをクリア
        ws.Cells.Clear
        ws.Cells.ClearFormats
    End If

    ' 祝日リストをシートに書き込む
    For i = LBound(holidayList) To UBound(holidayList)
        ws.Cells(i + 1, 1).Value = holidayList(i)(0)
        ws.Cells(i + 1, 2).Value = holidayList(i)(1)
    Next i

    ' 書式設定
    With ws.Range("A1:B" & UBound(holidayList) + 1)
        .Borders.LineStyle = xlContinuous
        .HorizontalAlignment = xlCenter
        .Columns("A:B").AutoFit
    End With

    ' ヘッダーのみ黄色塗りつぶし
    With ws.Range("A1:B1")
        .Interior.Color = RGB(255, 255, 0)
    End With
End Sub
            </pre>
        </div>
    </section>

    <section id="code-step7">
        <div class="step-title-container">
            <h2>ステップ7： 「祝日を赤」にする</h2>
            <button class="copy-button" onclick="copyToClipboard('#codeExample7')">コピーする</button>
        </div>
        <div class="code-container">
            <pre id="codeExample7">
Sub MarkHolidaysInRed()
    Dim calendarSheet As Worksheet
    Dim holidaySheet As Worksheet
    Dim calendarRange As Range
    Dim holidayRange As Range
    Dim calendarCell As Range
    Dim holidayCell As Range
    Dim currentYear As Integer
    Dim currentMonth As Integer
    Dim currentDate As Date
    Dim holidayDate As Date

    ' シートと範囲の設定
    Set calendarSheet = ThisWorkbook.Sheets("Sheet1")
    Set holidaySheet = ThisWorkbook.Sheets("祝日")
    Set calendarRange = calendarSheet.Range("A3:G8")
    Set holidayRange = holidaySheet.Range("B2", holidaySheet.Cells(holidaySheet.Rows.Count, "B").End(xlUp))

    ' セルA1の値から年月を取得し、完全な日付を生成
    currentYear = CInt(Left(calendarSheet.Range("A1").Value, 4))
    currentMonth = CInt(Right(calendarSheet.Range("A1").Value, 2))

    ' カレンダーの日付範囲をループし、各日付を完全な日付に変換
    For Each calendarCell In calendarRange
        If IsNumeric(calendarCell.Value) Then
            currentDate = DateSerial(currentYear, currentMonth, calendarCell.Value)

            ' 祝日リストをループし、日付を比較
            For Each holidayCell In holidayRange
                If IsDate(holidayCell.Value) Then
                    holidayDate = DateValue(holidayCell.Value)
                    ' 一致する場合、フォントの色を赤に設定
                    If currentDate = holidayDate Then
                        calendarCell.Font.Color = RGB(255, 0, 0) ' 赤色
                        Exit For ' 一致したらループを抜ける
                    End If
                End If
            Next holidayCell
        End If
    Next calendarCell
End Sub
            </pre>
        </div>
    </section>

    <section id="code-step8">
        <div class="step-title-container">
            <h2>ステップ8： 「シートクリア」＆「カレンダー作成」</h2>
            <button class="copy-button" onclick="copyToClipboard('#codeExample8')">コピーする</button>
        </div>
        <div class="code-container">
            <pre id="codeExample8">
Sub InitializeAndCreateCalendar()
    Dim ws As Worksheet
    Set ws = ThisWorkbook.Sheets("Sheet1")
    
    ' シートの初期化
    With ws
        .Cells.ClearContents
        .Cells.ClearFormats
        .Cells.MergeCells = False
    End With
    
    ' カレンダー作成のための各コードの呼び出し
    Call DisplayCurrentYearMonth
    Call SetCalendarHeaders
    Call DrawCalendarBorders
    Call AddDates
    Call ColorWeekends
    Call CreateHolidaySheet
    Call MarkHolidaysInRed
End Sub
            </pre>
        </div>
    </section>
    
    <section id="code-step9">
        <div class="step-title-container">
            <h2>ステップ9： 「ダブルクリック」で「赤塗りつぶし」</h2>
            <button class="copy-button" onclick="copyToClipboard('#codeExample9')">コピーする</button>
        </div>
        <div class="code-container">
            <pre id="codeExample9">
Private Sub Worksheet_BeforeDoubleClick(ByVal Target As Range, Cancel As Boolean)
    Dim rngCalendar As Range
    
    ' カレンダー範囲を指定（例：A3:G8）
    Set rngCalendar = Range("A3:G8")
    
    ' カレンダー内のセルがダブルクリックされた場合
    If Not Intersect(Target, rngCalendar) Is Nothing Then
        ' クリックされたセルが空白でない場合のみ実行
        If Target.Value <> "" Then
            ' 色を切り替え
            If Target.Interior.Color = RGB(255, 0, 0) Then
                Target.Interior.ColorIndex = xlNone ' 色を元に戻す
            Else
                Target.Interior.Color = RGB(255, 0, 0) ' 赤く塗りつぶす
            End If
            Cancel = True ' ダブルクリックイベントをキャンセル
        End If
    End If
End Sub
            </pre>
        </div>
    </section>

    <section id="code-step10">
        <div class="step-title-container">
            <h2>ステップ10： 仮の「メンバーシート」作成</h2>
            <button class="copy-button" onclick="copyToClipboard('#codeExample10')">コピーする</button>
        </div>
        <div class="code-container">
            <pre id="codeExample10">
Sub CreateMemberList()
    Dim ws As Worksheet
    Dim i As Integer
    Dim memberNames As Variant
        
    ' メンバー名のリスト
    memberNames = Array("田中 太郎", "山田 花子", "佐藤 雄大", "鈴木 美咲", "高橋 健太", _
                        "伊藤 まどか", "渡辺 拓也", "斎藤 亜美", "小林 健介", "中村 みゆき", _
                        "加藤 大輔", "吉田 美和", "山口 剛", "林 さくら", "清水 明美", _
                        "阿部 健太郎", "森田 未来", "岡田 優子", "橋本 貴之", "山崎 瞳")
        
    ' シートの取得または新規作成
    On Error Resume Next
    Set ws = ThisWorkbook.Sheets("管理用")
    On Error GoTo 0
    If ws Is Nothing Then
        Set ws = ThisWorkbook.Sheets.Add(After:=ThisWorkbook.Sheets(ThisWorkbook.Sheets.Count))
        ws.Name = "管理用"
    Else
        ws.Cells.Clear
        ws.Cells.ClearFormats
    End If
    
    ' ヘッダーの設定
    With ws.Range("A1:C1")
        .Value = Array("No", "氏名", "休み希望")
        .Font.Bold = True
        .Interior.Color = RGB(255, 255, 0) ' 黄色に塗りつぶし
        .HorizontalAlignment = xlCenter
    End With
    
    ' メンバーリストの設定
    For i = 1 To 20
        ws.Cells(i + 1, 1).Value = i ' 通し番号
        ws.Cells(i + 1, 2).Value = memberNames(i - 1) ' 氏名
        ws.Cells(i + 1, 3).Value = "" ' 休み希望
    Next i
    
    ' 全体を中央揃えに設定
    ws.Range("A2:C21").HorizontalAlignment = xlCenter
    
    ' セルに枠線を設定
    ws.Range("A1:C21").Borders.LineStyle = xlContinuous
    
    ' 列の幅を自動調整
    ws.Columns("A:C").AutoFit
End Sub
            </pre>
        </div>
    </section>

    <section id="code-step11">
        <div class="step-title-container">
            <h2>ステップ11： 「各メンバー用のカレンダー」作成</h2>
            <button class="copy-button" onclick="copyToClipboard('#codeExample11')">コピーする</button>
        </div>
        <div class="code-container">
            <pre id="codeExample11">
Private Sub Worksheet_BeforeDoubleClick(ByVal Target As Range, Cancel As Boolean)
    ' シート1のオブジェクトを取得
    Dim ws As Worksheet
    Set ws = ThisWorkbook.Sheets("Sheet1")
    
    ' 管理用シートのB列（B2以下）をチェック
    If Not Intersect(Target, Me.Range("B2:B" & Me.Rows.Count)) Is Nothing Then
        ' メンバー名を取得
        Dim memberName As String
        memberName = Target.Value
        
        ' カレンダーを作成
        InitializeAndCreateCalendar
            
        ' A1セルの内容を更新
        ws.Range("A1").Value = ws.Range("A1").Value & " " & memberName
            
        ' Sheet1をアクティブにする
        ws.Activate
        
        ' ダブルクリックによる編集をキャンセル
        Cancel = True
    End If
End Sub
            </pre>
        </div>
    </section>

    <section id="code-step12">
        <div class="step-title-container">
            <h2>ステップ12： 「休み希望」の「確定ボタン」設置</h2>
            <button class="copy-button" onclick="copyToClipboard('#codeExample12')">コピーする</button>
        </div>
        <div class="code-container">
            <pre id="codeExample12">
Sub AddCommandButton()
    Dim ws As Worksheet
    Dim btn As OLEObject
    Dim cell1 As Range, cell2 As Range
    Dim topPos As Double, leftPos As Double, btnWidth As Double, btnHeight As Double

    ' シートの参照
    Set ws = ThisWorkbook.Sheets("Sheet1")
    
    ' 既存のボタンが存在する場合は削除
    On Error Resume Next
    ws.OLEObjects("btnKakutei").Delete
    On Error GoTo 0

    ' I3とI4のセル範囲を取得
    Set cell1 = ws.Range("I3")
    Set cell2 = ws.Range("I4")

    ' ボタンの位置とサイズを設定
    topPos = cell1.Top
    leftPos = cell1.Left
    btnWidth = cell1.Width
    btnHeight = cell1.Height + cell2.Height

    ' コマンドボタンを追加
    Set btn = ws.OLEObjects.Add(ClassType:="Forms.CommandButton.1", _
                                Left:=leftPos, Top:=topPos, Width:=btnWidth, Height:=btnHeight)
    
    ' ボタンのキャプションと名前を設定
    With btn
        .Name = "btnKakutei"
        .Object.Caption = "確定"
    End With
End Sub
            </pre>
        </div>
    </section>

    <section id="code-step13">
        <div class="step-title-container">
            <h2>ステップ13： 「確定ボタン」で「休み希望」を収集</h2>
            <button class="copy-button" onclick="copyToClipboard('#codeExample13')">コピーする</button>
        </div>
        <div class="code-container">
            <pre id="codeExample13">
Private Sub btnKakutei_Click()
    Dim ws As Worksheet
    Set ws = ThisWorkbook.Sheets("Sheet1")
    Dim wsMgmt As Worksheet
    Set wsMgmt = ThisWorkbook.Sheets("管理用")
    
    Dim cell As Range
    Dim dates As String
    Dim name As String
    Dim yearMonth As String
    Dim targetRow As Long
    
    ' A1セルの氏名を取得（左から8文字目以降）
    yearMonth = ws.Range("A1").Value
    name = Mid(yearMonth, 9)
    
    ' メンバー名が空の場合は何もしない
    If Trim(name) = "" Then Exit Sub
    
    ' A3:G8の赤塗りつぶしセルの日付を取得
    For Each cell In ws.Range("A3:G8")
        If cell.Interior.Color = RGB(255, 0, 0) Then ' 赤色のセルを確認
            dates = dates & cell.Value & ","
        End If
    Next cell
    ' 最後のカンマを削除
    If Len(dates) > 0 Then dates = Left(dates, Len(dates) - 1)
    
    ' 氏名に一致する行を管理用シートから探す
    On Error Resume Next
    targetRow = Application.Match(name, wsMgmt.Range("B:B"), 0)
    On Error GoTo 0
    
    If targetRow > 0 Then
        ' C列に取得した日付をカンマ区切りで上書き
        wsMgmt.Cells(targetRow, 3).Value = dates
    Else
        MsgBox "氏名が見つかりません。"
    End If
End Sub
            </pre>
        </div>
    </section>

    <section id="code-step14">
        <div class="step-title-container">
            <h2>ステップ14： 「選択セル」に「メンバー」を自動割付</h2>
            <button class="copy-button" onclick="copyToClipboard('#codeExample14')">コピーする</button>
        </div>
        <div class="code-container">
            <pre id="codeExample14">
Sub AssignShifts()
    Dim ws As Worksheet
    Dim wsManagement As Worksheet
    Dim Candidates As Collection
    Dim MemberList As Range
    Dim MemberCount As Object ' Dictionary
    Dim MemberOffs As Object ' Dictionary
    Dim OffCount As Object ' Dictionary
    Dim i As Long
    Dim member As String
    Dim shiftDate As String
    Dim cell As Range
    Dim minCount As Long
    Dim maxCount As Long
    Dim maxOffCount As Long
    Dim memberCell As Range ' MemberListの各セルを表す変数
    Dim adjacentMembers As Collection ' 隣接するセルのメンバーを保持するコレクション
    Dim candidateArray() As Variant ' 配列に変換した候補メンバー

    ' シートの設定
    Set ws = ThisWorkbook.Sheets("Sheet1")
    Set wsManagement = ThisWorkbook.Sheets("管理用")

    ' 選択セルの確認
    If Selection.Cells.Count <> 1 Then
        Exit Sub
    End If

    ' 選択セルの範囲内確認
    If Intersect(Selection, ws.Range("A3:G8")) Is Nothing Then
        Exit Sub
    End If

    ' 選択セルが数値か確認
    If Not IsNumeric(Selection.Value) Or Selection.Value = "" Then
        Exit Sub
    End If

    ' メンバーのリスト取得
    Set MemberList = wsManagement.Range("B2", wsManagement.Cells(wsManagement.Rows.Count, 2).End(xlUp))

    ' メンバーの登場回数と休み希望日数をカウントする辞書を作成
    Set MemberCount = CreateObject("Scripting.Dictionary")
    Set OffCount = CreateObject("Scripting.Dictionary")
    Set MemberOffs = CreateObject("Scripting.Dictionary")
    For Each memberCell In MemberList
        member = memberCell.Value
        MemberCount(member) = 0
        MemberOffs(member) = Split(wsManagement.Cells(memberCell.Row, 3).Value, ",")
        OffCount(member) = UBound(MemberOffs(member)) - LBound(MemberOffs(member)) + 1
    Next memberCell

    ' A3:G8の範囲をチェックして登場回数をカウント
    For Each cell In ws.Range("A3:G8")
        If cell.Value <> "" Then
            For Each memberCell In MemberList
                If InStr(cell.Value, memberCell.Value) > 0 Then
                    MemberCount(memberCell.Value) = MemberCount(memberCell.Value) + 1
                End If
            Next memberCell
        End If
    Next cell

    ' 選択セルの値を取得
    shiftDate = CStr(Selection.Value)

    ' 最初に休み希望日を除外
    Set Candidates = New Collection
    For Each memberCell In MemberList
        member = memberCell.Value
        If Not IsNumberInArray(shiftDate, MemberOffs(member)) Then
            Candidates.Add member
        End If
    Next memberCell

    ' 割り付け候補がいない場合は終了
    If Candidates.Count = 0 Then
        MsgBox "割り付け可能なメンバーがいません。"
        Exit Sub
    End If

    ' Candidatesを配列に変換
    If Candidates.Count > 0 Then
        ReDim candidateArray(1 To Candidates.Count)
        For i = 1 To Candidates.Count
            candidateArray(i) = Candidates(i)
        Next i
    Else
        Exit Sub
    End If

    ' 登場回数が全員同じ場合は全員をCandidatesに残す
    minCount = Application.WorksheetFunction.Min(MemberCount.items)
    maxCount = Application.WorksheetFunction.Max(MemberCount.items)
    If minCount <> maxCount Then
        ' 登場回数が最小のメンバーのみをCandidatesに残す
        Dim tempCandidates As Collection
        Set tempCandidates = New Collection
        For i = LBound(candidateArray) To UBound(candidateArray)
            member = candidateArray(i)
            If MemberCount(member) = minCount Then
                tempCandidates.Add member
            End If
        Next i
        Set Candidates = tempCandidates

        ' Candidatesを配列に再変換
        If Candidates.Count > 0 Then
            ReDim candidateArray(1 To Candidates.Count)
            For i = 1 To Candidates.Count
                candidateArray(i) = Candidates(i)
            Next i
        Else
            Exit Sub
        End If
    Else
        ' 登場回数が全員同じ場合はそのままCandidatesを使用
        If Candidates.Count > 0 Then
            ReDim candidateArray(1 To Candidates.Count)
            For i = 1 To Candidates.Count
                candidateArray(i) = Candidates(i)
            Next i
        Else
            Exit Sub
        End If
    End If

    ' 左右の隣接セルのメンバーを取得
    Set adjacentMembers = New Collection
    Dim colIndex As Long
    Dim rowIndex As Long
    colIndex = Selection.Column
    rowIndex = Selection.Row

    ' 左隣のセル（特別条件を含む）
    If colIndex > 1 Then
        ' 通常の左隣
        If ws.Cells(rowIndex, colIndex - 1).Value <> "" Then
            For Each memberCell In MemberList
                If InStr(ws.Cells(rowIndex, colIndex - 1).Value, memberCell.Value) > 0 Then
                    On Error Resume Next
                    adjacentMembers.Add memberCell.Value, CStr(memberCell.Value)
                    On Error GoTo 0
                End If
            Next memberCell
        End If
    ElseIf colIndex = 1 And rowIndex > 3 Then
        ' 左端の場合の特別条件（A列）
        ' B列のセル
        If ws.Cells(rowIndex, colIndex + 1).Value <> "" Then
            For Each memberCell In MemberList
                If InStr(ws.Cells(rowIndex, colIndex + 1).Value, memberCell.Value) > 0 Then
                    On Error Resume Next
                    adjacentMembers.Add memberCell.Value, CStr(memberCell.Value)
                    On Error GoTo 0
                End If
            Next memberCell
        End If
        ' 上行のG列のセル
        If ws.Cells(rowIndex - 1, 7).Value <> "" Then
            For Each memberCell In MemberList
                If InStr(ws.Cells(rowIndex - 1, 7).Value, memberCell.Value) > 0 Then
                    On Error Resume Next
                    adjacentMembers.Add memberCell.Value, CStr(memberCell.Value)
                    On Error GoTo 0
                End If
            Next memberCell
        End If
    End If

    ' 右隣のセル（特別条件を含む）
    If colIndex < 7 Then
        ' 通常の右隣
        If ws.Cells(rowIndex, colIndex + 1).Value <> "" Then
            For Each memberCell In MemberList
                If InStr(ws.Cells(rowIndex, colIndex + 1).Value, memberCell.Value) > 0 Then
                    On Error Resume Next
                    adjacentMembers.Add memberCell.Value, CStr(memberCell.Value)
                    On Error GoTo 0
                End If
            Next memberCell
        End If
    ElseIf colIndex = 7 And rowIndex < 8 Then
        ' 右端の場合の特別条件（G列）
        ' F列のセル
        If ws.Cells(rowIndex, colIndex - 1).Value <> "" Then
            For Each memberCell In MemberList
                If InStr(ws.Cells(rowIndex, colIndex - 1).Value, memberCell.Value) > 0 Then
                    On Error Resume Next
                    adjacentMembers.Add memberCell.Value, CStr(memberCell.Value)
                    On Error GoTo 0
                End If
            Next memberCell
        End If
        ' 下行のA列のセル
        If ws.Cells(rowIndex + 1, 1).Value <> "" Then
            For Each memberCell In MemberList
                If InStr(ws.Cells(rowIndex + 1, 1).Value, memberCell.Value) > 0 Then
                    On Error Resume Next
                    adjacentMembers.Add memberCell.Value, CStr(memberCell.Value)
                    On Error GoTo 0
                End If
            Next memberCell
        End If
    End If

    ' 割り付け候補から隣接メンバーを除外
    Dim finalCandidates As Collection
    Set finalCandidates = New Collection
    For i = LBound(candidateArray) To UBound(candidateArray)
        member = candidateArray(i)
        If Not IsInCollection(adjacentMembers, member) Then
            finalCandidates.Add member
        End If
    Next i

    ' finalCandidatesが空の場合は終了
    If finalCandidates.Count = 0 Then
        MsgBox "割り付け可能なメンバーがいません。"
        Exit Sub
    End If

    ' finalCandidatesを配列に変換
    If finalCandidates.Count > 0 Then
        ReDim candidateArray(1 To finalCandidates.Count)
        For i = 1 To finalCandidates.Count
            candidateArray(i) = finalCandidates(i)
        Next i
    Else
        Exit Sub
    End If

    ' finalCandidatesから最大の休み希望日数を持つメンバーのみを残す
    maxOffCount = Application.WorksheetFunction.Max(GetOffCounts(candidateArray, OffCount))
    Dim maxOffCandidates As Collection
    Set maxOffCandidates = New Collection
    For i = LBound(candidateArray) To UBound(candidateArray)
        member = candidateArray(i)
        If OffCount(member) = maxOffCount Then
            maxOffCandidates.Add member
        End If
    Next i

    ' maxOffCandidatesが空の場合は終了
    If maxOffCandidates.Count = 0 Then
        MsgBox "割り付け可能なメンバーがいません。"
        Exit Sub
    End If

    ' maxOffCandidatesを配列に変換
    If maxOffCandidates.Count > 0 Then
        ReDim candidateArray(1 To maxOffCandidates.Count)
        For i = 1 To maxOffCandidates.Count
            candidateArray(i) = maxOffCandidates(i)
        Next i
    Else
        Exit Sub
    End If

    ' 候補メンバーをシャッフル
    For i = UBound(candidateArray) To LBound(candidateArray) Step -1
        shuffleIndex = Int((i - LBound(candidateArray) + 1) * Rnd + LBound(candidateArray))
        member = candidateArray(shuffleIndex)
        candidateArray(shuffleIndex) = candidateArray(i)
        candidateArray(i) = member
    Next i

    ' 割り付け実行
    For i = LBound(candidateArray) To UBound(candidateArray)
        member = candidateArray(i)
        Selection.Value = Selection.Value & vbCrLf & member
        MemberCount(member) = MemberCount(member) + 1
        Exit For
    Next i
End Sub

Function IsNumberInArray(num As String, arr As Variant) As Boolean
    Dim i As Long
    IsNumberInArray = False
    For i = LBound(arr) To UBound(arr)
        If arr(i) = num Then
            IsNumberInArray = True
            Exit Function
        End If
    Next i
End Function

Function IsInCollection(coll As Collection, key As String) As Boolean
    Dim var As Variant
    On Error Resume Next
    var = coll(key)
    On Error GoTo 0
    If IsEmpty(var) Then
        IsInCollection = False
    Else
        IsInCollection = True
    End If
End Function

Function GetOffCounts(candidateArray As Variant, OffCount As Object) As Variant
    Dim counts() As Long
    ReDim counts(LBound(candidateArray) To UBound(candidateArray))
    Dim i As Long
    For i = LBound(candidateArray) To UBound(candidateArray)
        counts(i) = OffCount(candidateArray(i))
    Next i
    GetOffCounts = counts
End Function
            </pre>
        </div>
    </section>

    <section id="code-step15">
        <div class="step-title-container">
            <h2>ステップ15： 「一か月分」の「メンバー」を自動割付</h2>
            <button class="copy-button" onclick="copyToClipboard('#codeExample15')">コピーする</button>
        </div>
        <div class="code-container">
            <pre id="codeExample15">
Sub AssignShiftsBasedOnMemberOffDays()
    Dim wsManagement As Worksheet
    Dim ws As Worksheet
    Dim memberCell As Range
    Dim memberOffDays As Variant
    Dim offCountArray() As Variant
    Dim sortedMembers() As Variant
    Dim availableDays As Collection
    Dim day As Variant
    Dim maxDay As Long
    Dim member As String
    Dim i As Long, j As Long
    Dim allAssigned As Boolean

    ' シートの設定
    Set wsManagement = ThisWorkbook.Sheets("管理用")
    Set ws = ThisWorkbook.Sheets("Sheet1")

    ' メンバーのリストと休み希望日を配列に格納
    Dim MemberOffs As Object
    Set MemberOffs = CreateObject("Scripting.Dictionary")
    Dim MemberList() As String
    Dim memberIndex As Long
    memberIndex = 0
    For Each memberCell In wsManagement.Range("B2", wsManagement.Cells(wsManagement.Rows.Count, 2).End(xlUp))
        member = memberCell.Value
        memberOffDays = Split(wsManagement.Cells(memberCell.Row, 3).Value, ",")
        MemberOffs(member) = memberOffDays
        memberIndex = memberIndex + 1
        ReDim Preserve MemberList(1 To memberIndex)
        MemberList(memberIndex) = member
    Next memberCell

    ' 休み希望日数をカウントし、配列に格納
    ReDim offCountArray(1 To memberIndex, 1 To 2)
    For i = 1 To memberIndex
        member = MemberList(i)
        offCountArray(i, 1) = member
        offCountArray(i, 2) = UBound(MemberOffs(member)) - LBound(MemberOffs(member)) + 1
    Next i

    ' 休み希望日数でソート
    Call BubbleSort(offCountArray, 2)

    ' ソートされたメンバーを取得
    ReDim sortedMembers(1 To UBound(offCountArray, 1))
    For i = 1 To UBound(offCountArray, 1)
        sortedMembers(i) = offCountArray(i, 1)
    Next i

    ' カレンダーの日数の範囲を決定
    maxDay = GetMaxDayInCalendar(ws)

    ' 全てのセルに割り付けが完了するまでループ
    Do
        allAssigned = True
        ' メンバーごとに割り付けを実行
        For i = LBound(sortedMembers) To UBound(sortedMembers)
            member = sortedMembers(i)

            ' 休み希望日を除外した利用可能な日を取得
            Set availableDays = New Collection
            For day = 1 To maxDay
                If Not IsNumberInArray(CStr(day), MemberOffs(member)) Then
                    availableDays.Add day
                End If
            Next day

            ' 利用可能な日がある限りシフトを割り付け
            Do While availableDays.Count > 0
                Dim randomIndex As Long
                randomIndex = Int(Rnd() * availableDays.Count) + 1
                day = availableDays(randomIndex)

                ' 対応するセルを選択
                Set cell = FindDateCell(ws, CLng(day))
                If Not cell Is Nothing Then
                    If IsNumeric(cell.Value) Then
                        cell.Select
                        Call AssignShifts
                        allAssigned = False ' 割り付けが成功した場合
                        Exit Do ' 割り付けが成功したらループを抜ける
                    End If
                End If

                ' 選択した日を利用可能日リストから削除
                availableDays.Remove randomIndex
            Loop
        Next i
    Loop While Not allAssigned And Not AllCellsAssigned(ws)

End Sub

Function BubbleSort(arr As Variant, col As Long)
    Dim i As Long, j As Long
    Dim temp1 As Variant, temp2 As Variant

    For i = LBound(arr, 1) To UBound(arr, 1) - 1
        For j = i + 1 To UBound(arr, 1)
            If arr(i, col) < arr(j, col) Then
                ' Swap values in the array
                temp1 = arr(i, 1)
                temp2 = arr(i, 2)
                arr(i, 1) = arr(j, 1)
                arr(i, 2) = arr(j, 2)
                arr(j, 1) = temp1
                arr(j, 2) = temp2
            End If
        Next j
    Next i
End Function

Function GetMaxDayInCalendar(ws As Worksheet) As Long
    Dim maxDay As Long
    maxDay = Application.WorksheetFunction.Max(ws.Range("A3:G8"))
    GetMaxDayInCalendar = maxDay
End Function

Function FindDateCell(ws As Worksheet, dateValue As Long) As Range
    Dim cell As Range
    For Each cell In ws.Range("A3:G8")
        If cell.Value = dateValue Then
            Set FindDateCell = cell
            Exit Function
        End If
    Next cell
    Set FindDateCell = Nothing
End Function

Function IsNumberInArray(num As String, arr As Variant) As Boolean
    Dim i As Long
    IsNumberInArray = False
    For i = LBound(arr) To UBound(arr)
        If arr(i) = num Then
            IsNumberInArray = True
            Exit Function
        End If
    Next i
End Function

Function AllCellsAssigned(ws As Worksheet) As Boolean
    Dim cell As Range
    For Each cell In ws.Range("A3:G8")
        If IsNumeric(cell.Value) Then
            AllCellsAssigned = False
            Exit Function
        End If
    Next cell
    AllCellsAssigned = True
End Function
            </pre>
        </div>
    </section>

    <section id="code-step16-1">
        <div class="step-title-container">
            <h2>ステップ16-1： 「保存終了」ボタンを設置</h2>
            <button class="copy-button" onclick="copyToClipboard('#codeExample16-1')">コピーする</button>
        </div>
        <div class="code-container">
            <pre id="codeExample16-1">
Sub AddCommandButton2()
    Dim ws As Worksheet
    Dim btn As OLEObject
    Dim cell1 As Range, cell2 As Range
    Dim topPos As Double, leftPos As Double, btnWidth As Double, btnHeight As Double

    ' シートの参照
    Set ws = ThisWorkbook.Sheets("Sheet1")
    
    ' 既存のボタンが存在する場合は削除
    On Error Resume Next
    ws.OLEObjects("btnHozonShuryo").Delete
    On Error GoTo 0

    ' I5とI6のセル範囲を取得
    Set cell1 = ws.Range("I5")
    Set cell2 = ws.Range("I6")

    ' ボタンの位置とサイズを設定
    topPos = cell1.Top
    leftPos = cell1.Left
    btnWidth = cell1.Width
    btnHeight = cell1.Height + cell2.Height

    ' コマンドボタンを追加
    Set btn = ws.OLEObjects.Add(ClassType:="Forms.CommandButton.1", _
                                Left:=leftPos, Top:=topPos, Width:=btnWidth, Height:=btnHeight)
    
    ' ボタンのキャプションと名前を設定
    With btn
        .name = "btnHozonShuryo"
        .Object.Caption = "保存終了"
    End With
End Sub
            </pre>
        </div>
    </section>

        <section id="code-step16-2">
        <div class="step-title-container">
            <h2>ステップ16-2：  「保存終了」ボタンでバックアップファイル作成</h2>
            <button class="copy-button" onclick="copyToClipboard('#codeExample16-2')">コピーする</button>
        </div>
        <div class="code-container">
            <pre id="codeExample16-2">
Private Sub btnHozonShuryo_Click()
    Dim backupPath As String
    Dim originalPath As String
    Dim originalFileFormat As XlFileFormat
    
    ' 現在のワークブックのパスと名前を取得
    originalPath = ThisWorkbook.FullName
    originalFileFormat = ThisWorkbook.FileFormat
    
    ' バックアップファイルのパスを設定
    backupPath = ThisWorkbook.Path & "\backup_" & Format(Now, "yyyymmdd_hhmmss") & ".xlsm"
    
    ' アラートメッセージを無効化
    Application.DisplayAlerts = False
    
    ' バックアップファイルとして保存
    ThisWorkbook.SaveAs Filename:=backupPath, FileFormat:=xlOpenXMLWorkbookMacroEnabled
    
    ' 元の名前で再度保存
    ThisWorkbook.SaveAs Filename:=originalPath, FileFormat:=originalFileFormat
    
    ' アラートメッセージを再有効化
    Application.DisplayAlerts = True
    
    ' ワークブックを閉じる
    ThisWorkbook.Close SaveChanges:=False
End Sub
            </pre>
        </div>
    </section>
            <section id="code-step17-1">
        <div class="step-title-container">
            <h2>ステップ17-1：   1か月分のExcelファイルを含むフォルダを作成</h2>
            <button class="copy-button" onclick="copyToClipboard('#codeExample17-1')">コピーする</button>
        </div>
        <div class="code-container">
            <pre id="codeExample17-1">
Sub CreateExcelFiles()
    Dim ws As Worksheet
    Dim wb As Workbook
    Dim folderPath As String
    Dim subFolderPath As String
    Dim i As Integer
    Dim j As Integer
    Dim randValue As Integer
    Dim header As Variant
    Dim filename As String
    Dim fDialog As FileDialog
    
    ' フォルダ選択ダイアログの設定
    Set fDialog = Application.FileDialog(msoFileDialogFolderPicker)
    With fDialog
        .Title = "保存するフォルダを選択してください"
        .AllowMultiSelect = False
        If .Show = -1 Then ' ユーザーがフォルダを選択した場合
            folderPath = .SelectedItems(1)
        Else
            MsgBox "フォルダが選択されませんでした。処理を中止します。", vbExclamation
            Exit Sub
        End If
    End With
    
    ' サブフォルダの設定
    subFolderPath = folderPath & Application.PathSeparator & "2024.4"
    
    ' サブフォルダの存在を確認し、存在しない場合は作成
    On Error Resume Next
    MkDir subFolderPath
    If Err.Number <> 0 Then
        MsgBox "フォルダを作成できませんでした: " & subFolderPath, vbCritical
        Exit Sub
    End If
    On Error GoTo 0

    ' ヘッダーの設定
    header = Array("病名", "A病", "B病", "C病", "D病", "E病")

    ' 30個のExcelファイルを作成
    For i = 1 To 30
        ' 新しいワークブックを作成
        Set wb = Workbooks.Add
        Set ws = wb.Sheets(1)

        ' ヘッダーの入力
        For j = 1 To 6
            ws.Cells(1, j).Value = header(j - 1)
        Next j

        ' ヘッダーの黄色塗りつぶし
        ws.Range("A1:F1").Interior.Color = RGB(255, 255, 0)

        ' A2セルに「患者数」と入力
        ws.Cells(2, 1).Value = "患者数"

        ' B2:F2セルにランダムな数値を入力
        For j = 2 To 6
            randValue = Application.WorksheetFunction.RandBetween(1, 100)
            ws.Cells(2, j).Value = randValue
        Next j

        ' 格子枠の設定
        With ws.Range("A1:F2").Borders
            .LineStyle = xlContinuous
            .Weight = xlThin
        End With

        ' 文字を中央揃え
        With ws.Range("A1:F2")
            .HorizontalAlignment = xlCenter
            .VerticalAlignment = xlCenter
        End With

        ' 列幅の自動調整
        ws.Columns("A:F").AutoFit

        ' ファイル名の設定
        filename = subFolderPath & Application.PathSeparator & "4." & i & ".xlsx"

        ' ファイルを保存して閉じる
        On Error Resume Next
        wb.SaveAs filename
        On Error GoTo 0
        wb.Close False
    Next i

    ' データ集積用の空ファイルを作成
    Set wb = Workbooks.Add
    On Error Resume Next
    wb.SaveAs subFolderPath & Application.PathSeparator & "データ集積用.xlsx"
    On Error GoTo 0
    wb.Close False

    ' 完了メッセージ
    MsgBox "30個のファイルとデータ集積用のファイルを作成しました。", vbInformation
End Sub
            </pre>
        </div>
    </section>
            <section id="code-step17-2">
        <div class="step-title-container">
            <h2>ステップ17-2：  1か月分のExcelファイルからのデータ収集</h2>
            <button class="copy-button" onclick="copyToClipboard('#codeExample17-2')">コピーする</button>
        </div>
        <div class="code-container">
            <pre id="codeExample17-2">
Sub ImportData()
    Dim ws As Worksheet
    Dim folderPath As String
    Dim fileName As String
    Dim rowIndex As Long
    Dim folderName As String
    Dim yearMonth As Variant
    Dim year As Integer
    Dim month As Integer
    Dim lastDay As Integer
    Dim filePrefix As String
    Dim srcWorkbook As Workbook
    Dim srcSheet As Worksheet

    ' フォルダパスとフォルダ名の設定
    folderPath = ThisWorkbook.Path & "\"

    ' フォルダ名の抽出（末尾のスラッシュを除去）
    folderName = Mid(Left(folderPath, Len(folderPath) - 1), InStrRev(Left(folderPath, Len(folderPath) - 1), "\") + 1)

    ' フォルダ名が "YYYY.M" または "YYYY.MM" 形式であることを確認し、年月を取得
    If IsNumeric(Left(folderName, 4)) And Mid(folderName, 5, 1) = "." And IsNumeric(Mid(folderName, 6)) Then
        yearMonth = Split(folderName, ".")
        year = CInt(yearMonth(0))
        month = CInt(yearMonth(1))
        lastDay = Day(DateSerial(year, month + 1, 0)) ' 月の最終日を取得
        filePrefix = month & "." ' ファイルプレフィックスの設定
    Else
        MsgBox "フォルダ名が 'YYYY.M' または 'YYYY.MM' 形式ではありません。"
        Exit Sub
    End If

    ' アクティブシートを設定
    Set ws = ActiveSheet

    ' アクティブシートの内容をクリア
    ws.Cells.Clear

    ' ヘッダーの設定
    ws.Cells(1, 1).Value = month & "月"
    ws.Cells(1, 2).Value = "A病"
    ws.Cells(1, 3).Value = "B病"
    ws.Cells(1, 4).Value = "C病"
    ws.Cells(1, 5).Value = "D病"
    ws.Cells(1, 6).Value = "E病"

    ' ヘッダーのフォーマット設定
    With ws.Range("A1:F1")
        .Interior.Color = RGB(255, 255, 0) ' ヘッダーを黄色で塗りつぶし
        .Font.Bold = True
        .HorizontalAlignment = xlCenter ' 文字を中央揃え
        .VerticalAlignment = xlCenter ' 文字を中央揃え
    End With

    ' 初期行インデックスの設定（A2が開始地点）
    rowIndex = 2

    ' 1日から月の最終日までのループ
    Dim i As Integer
    For i = 1 To lastDay
        ' ファイル名の設定
        fileName = folderPath & filePrefix & i & ".xlsx"

        ' 日付をA列に設定
        ws.Cells(rowIndex, 1).Value = i

        ' ファイルが存在する場合のみ処理を行う
        If Dir(fileName) <> "" Then
            ' ファイルを開く
            Set srcWorkbook = Workbooks.Open(fileName)
            Set srcSheet = srcWorkbook.Sheets(1)

            ' 各セルの値を取得して貼り付け
            ws.Cells(rowIndex, 2).Value = srcSheet.Range("B2").Value ' B列
            ws.Cells(rowIndex, 3).Value = srcSheet.Range("C2").Value ' C列
            ws.Cells(rowIndex, 4).Value = srcSheet.Range("D2").Value ' D列
            ws.Cells(rowIndex, 5).Value = srcSheet.Range("E2").Value ' E列
            ws.Cells(rowIndex, 6).Value = srcSheet.Range("F2").Value ' F列

            ' ファイルを閉じる
            srcWorkbook.Close False
        End If

        ' 次の行に移動
        rowIndex = rowIndex + 1
    Next i

    ' 合計を追加
    ws.Cells(rowIndex, 1).Value = "合計"
    ws.Cells(rowIndex, 2).Formula = "=SUM(B2:B" & rowIndex - 1 & ")"
    ws.Cells(rowIndex, 3).Formula = "=SUM(C2:C" & rowIndex - 1 & ")"
    ws.Cells(rowIndex, 4).Formula = "=SUM(D2:D" & rowIndex - 1 & ")"
    ws.Cells(rowIndex, 5).Formula = "=SUM(E2:E" & rowIndex - 1 & ")"
    ws.Cells(rowIndex, 6).Formula = "=SUM(F2:F" & rowIndex - 1 & ")"

    ' 次の行に移動して平均を追加
    rowIndex = rowIndex + 1
    ws.Cells(rowIndex, 1).Value = "平均"
    ws.Cells(rowIndex, 2).Formula = "=ROUND(AVERAGE(B2:B" & rowIndex - 2 & "), 1)"
    ws.Cells(rowIndex, 3).Formula = "=ROUND(AVERAGE(C2:C" & rowIndex - 2 & "), 1)"
    ws.Cells(rowIndex, 4).Formula = "=ROUND(AVERAGE(D2:D" & rowIndex - 2 & "), 1)"
    ws.Cells(rowIndex, 5).Formula = "=ROUND(AVERAGE(E2:E" & rowIndex - 2 & "), 1)"
    ws.Cells(rowIndex, 6).Formula = "=ROUND(AVERAGE(F2:F" & rowIndex - 2 & "), 1)"

    ' 全体の格子枠を設定
    With ws.Range("A1:F" & rowIndex).Borders
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With

    ' 文字を中央揃えに設定
    With ws.Range("A1:F" & rowIndex)
        .HorizontalAlignment = xlCenter
        .VerticalAlignment = xlCenter
    End With

    ' 列の幅を自動調整
    ws.Columns("A:F").AutoFit
End Sub
            </pre>
        </div>
    </section>
                
    <script>
        function copyToClipboard(element) {
            var temp = document.createElement('textarea');
            temp.value = document.querySelector(element).innerText;
            document.body.appendChild(temp);
            temp.select();
            document.execCommand('copy');
            document.body.removeChild(temp);
            alert('コピーしました');
        }

        // スクロールするとボタンが表示されるようにする
        window.onscroll = function() {scrollFunction()};

        function scrollFunction() {
            if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
                document.getElementById("backToTopBtn").style.display = "block";
            } else {
                document.getElementById("backToTopBtn").style.display = "none";
            }
        }

        // ボタンをクリックするとページの一番上に戻る
        function topFunction() {
            document.body.scrollTop = 0; // For Safari
            document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE and Opera
        }
    </script>

    <button onclick="topFunction()" id="backToTopBtn" title="一番上に戻る">▲</button>

    <style>
        #backToTopBtn {
            display: none; /* デフォルトでは非表示 */
            position: fixed; /* 固定位置 */
            bottom: 20px; /* 下からの距離 */
            right: 30px; /* 右からの距離 */
            z-index: 99; /* 他の要素の上に表示 */
            border: none; /* ボーダーなし */
            outline: none; /* アウトラインなし */
            background-color: #555; /* ボタンの背景色 */
            color: white; /* ボタンの文字色 */
            cursor: pointer; /* カーソル */
            padding: 15px; /* パディング */
            border-radius: 10px; /* ボーダーの丸み */
            font-size: 18px; /* 文字サイズ */
        }

        #backToTopBtn:hover {
            background-color: #333; /* ホバー時の背景色 */
        }
    </style>
                
</body>
</html>

